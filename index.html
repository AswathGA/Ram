<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Tap to Open üíå</title>
  <style>
    :root{
      --bg1:#0b1026;
      --bg2:#1a0b2e;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent:#ff4d8d;
      --accent2:#7c5cff;
      --good:#38d39f;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--txt);
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 20% 20%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(255,77,141,.18), transparent 55%),
        radial-gradient(800px 600px at 50% 90%, rgba(56,211,159,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    /* Subtle moving glow */
    .glow{
      position:fixed; inset:-40%;
      background:
        radial-gradient(closest-side, rgba(255,77,141,.10), transparent 70%),
        radial-gradient(closest-side, rgba(124,92,255,.10), transparent 70%);
      filter: blur(20px);
      animation: drift 14s ease-in-out infinite alternate;
      pointer-events:none;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      from{ transform: translate(-2%, -1%) scale(1.05); }
      to{ transform: translate(2%, 1%) scale(1.10); }
    }

    canvas#fx{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; }

    .wrap{
      position:relative;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .panel{
      width:min(560px, 96vw);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      position:relative;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(90deg, rgba(124,92,255,.10), rgba(255,77,141,.10));
    }
    .brand{
      display:flex;
      gap:10px;
      align-items:center;
      font-weight:700;
      letter-spacing:.2px;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      color:var(--muted);
    }

    .content{
      padding:18px 16px 18px;
      display:grid;
      gap:14px;
    }

    /* Envelope */
    .envelopeStage{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:18px 16px 22px;
      min-height: 420px;
      gap:14px;
    }
    .hint{ color:var(--muted); font-size:13px; text-align:center; line-height:1.35; }
    .bigTitle{
      font-size: clamp(20px, 4vw, 28px);
      font-weight:800;
      text-align:center;
      line-height:1.15;
    }
    .sub{ font-size:14px; color:var(--muted); text-align:center; }

    .env{
      width: min(340px, 82vw);
      aspect-ratio: 4/3;
      position:relative;
      transform: translateZ(0);
      filter: drop-shadow(0 20px 40px rgba(0,0,0,.35));
    }
    .env .back{
      position:absolute; inset:0;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.18);
    }
    .env .paper{
      position:absolute;
      left: 10%;
      right: 10%;
      bottom: 10%;
      height: 70%;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.10));
      border: 1px solid rgba(255,255,255,.16);
      transform-origin: bottom;
      transform: translateY(18%) scaleY(.78);
      opacity:.0;
      transition: transform 900ms cubic-bezier(.2,.9,.2,1), opacity 500ms ease;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden;
    }
    .paper .line{
      height:10px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
    }
    .paper .line:nth-child(2){ width:86%; }
    .paper .line:nth-child(3){ width:72%; }
    .paper .line:nth-child(4){ width:88%; }

    .env .front{
      position:absolute; inset:0;
      border-radius: 18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
    }
    .env .front:before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(closest-side, rgba(255,77,141,.18), transparent 70%);
      transform: rotate(18deg);
      opacity:.7;
    }

    .env .flap{
      position:absolute;
      left:0; right:0; top:0;
      height:60%;
      transform-origin: top;
      clip-path: polygon(0 0, 100% 0, 50% 80%);
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.06));
      border-bottom: 1px solid rgba(255,255,255,.14);
      transform: rotateX(0deg);
      transition: transform 900ms cubic-bezier(.15,.95,.2,1);
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.22));
    }

    .seal{
      position:absolute;
      left:50%; top:56%;
      transform: translate(-50%,-50%);
      width:72px; height:72px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.28), rgba(255,255,255,.10));
      border: 1px solid rgba(255,255,255,.18);
      display:grid;
      place-items:center;
      cursor:pointer;
      transition: transform 200ms ease, box-shadow 250ms ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      user-select:none;
    }
    .seal:active{ transform: translate(-50%,-50%) scale(.98); }
    .seal:hover{ box-shadow: 0 14px 44px rgba(0,0,0,.42); }
    .heart{
      width: 26px; height: 26px;
      position:relative;
      transform: rotate(-45deg);
      background: linear-gradient(135deg, var(--accent), #ff86b6);
      border-radius: 7px;
      animation: pulse 1.3s ease-in-out infinite;
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width: 26px; height: 26px;
      background: inherit;
      border-radius: 50%;
    }
    .heart:before{ top:-13px; left:0; }
    .heart:after{ left:13px; top:0; }
    @keyframes pulse{
      0%,100%{ transform: rotate(-45deg) scale(1); filter: brightness(1); }
      50%{ transform: rotate(-45deg) scale(1.12); filter: brightness(1.08); }
    }

    .btnRow{
      display:flex;
      gap:10px;
      width:100%;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .btn{
      border:0;
      cursor:pointer;
      color:var(--txt);
      font-weight:700;
      padding:12px 16px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,77,141,.95), rgba(124,92,255,.95));
      box-shadow: 0 14px 36px rgba(0,0,0,.35);
      transition: transform 160ms ease, filter 160ms ease;
      letter-spacing:.2px;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.secondary{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow:none;
      font-weight:650;
      color:var(--muted);
    }

    /* Open animation state */
    .opened .flap{ transform: rotateX(155deg); }
    .opened .paper{
      opacity:1;
      transform: translateY(-6%) scaleY(1);
    }
    .opened .seal{ transform: translate(-50%,-50%) scale(.88); opacity:.0; pointer-events:none; }

    /* Slides */
    .slides{
      display:none;
      padding:16px;
      gap:12px;
    }
    .slides.show{ display:grid; }
    .slide{
      display:none;
      padding:16px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.25);
      min-height: 320px;
      position:relative;
      overflow:hidden;
    }
    .slide.active{ display:block; animation: in 420ms ease; }
    @keyframes in{
      from{ transform: translateY(10px); opacity:.0; }
      to{ transform: translateY(0); opacity:1; }
    }
    .kicker{ font-size:12px; color:var(--muted); letter-spacing:.18em; text-transform:uppercase; }
    .h1{ font-size: clamp(22px, 4.8vw, 34px); font-weight:900; margin:8px 0 10px; line-height:1.05; }
    .p{ color:var(--muted); font-size:15px; line-height:1.55; max-width: 46ch; }
    .chipRow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .chip{
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      font-size:13px;
      color: rgba(255,255,255,.80);
    }

    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:10px;
    }
    .dots{ display:flex; gap:6px; align-items:center; justify-content:center; flex:1; }
    .dot{
      width:8px; height:8px; border-radius:99px;
      background: rgba(255,255,255,.22);
      transition: transform 160ms ease, background 160ms ease, width 160ms ease;
    }
    .dot.on{ background: rgba(255,255,255,.72); width:16px; }

    /* Cute ‚Äúsparkles‚Äù inside slides */
    .sparkle{
      position:absolute;
      inset:auto;
      width: 180px;
      height: 180px;
      right:-60px;
      bottom:-60px;
      background: radial-gradient(closest-side, rgba(56,211,159,.18), transparent 70%);
      filter: blur(2px);
      transform: rotate(18deg);
      opacity:.9;
      animation: float 6s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes float{
      from{ transform: translate(0,0) rotate(18deg); }
      to{ transform: translate(-10px,-12px) rotate(22deg); }
    }

    /* Photo grid */
    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .ph{
      aspect-ratio: 1/1;
      border-radius: 16px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.22), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
      transform: rotate(var(--r, -2deg));
      transition: transform 220ms ease;
      position:relative;
    }
    .ph:hover{ transform: rotate(0deg) scale(1.02); }
    .ph img{ width:100%; height:100%; object-fit:cover; display:block; filter: saturate(1.08) contrast(1.02); }
    .ph .tag{
      position:absolute; left:10px; bottom:10px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.30);
      border: 1px solid rgba(255,255,255,.18);
      font-size:12px;
      color: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* Valentine question */
    .qRow{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;
      align-items:center;
    }
    .yes{
      background: linear-gradient(90deg, rgba(56,211,159,.95), rgba(255,77,141,.95));
    }
    .no{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow:none;
      color: rgba(255,255,255,.78);
      position:relative;
    }

    /* Footer tip */
    .foot{
      padding:12px 16px 16px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.62);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Small screens */
    @media (max-height: 720px){
      body{ overflow:auto; }
      .wrap{ align-items:flex-start; padding-top:18px; }
    }
  </style>
</head>
<body>
  <div class="glow"></div>
  <canvas id="fx"></canvas>

  <div class="wrap">
    <div class="panel" id="panel">
      <div class="topbar">
        <div class="brand">üíå <span id="brandText">A little note for you</span></div>
        <div class="badge" id="badgeText">Tap to open</div>
      </div>

      <!-- ENVELOPE -->
      <div class="envelopeStage" id="stage">
        <div class="bigTitle" id="titleText">Hey <span id="herNameA">Love</span>‚Ä¶ I made you something ‚ú®</div>
        <div class="sub" id="subText">One tap. Then the surprises start.</div>

        <div class="env" id="env">
          <div class="back"></div>
          <div class="paper">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
          </div>
          <div class="front"></div>
          <div class="flap"></div>
          <div class="seal" id="seal" aria-label="Open">
            <div class="heart"></div>
          </div>
        </div>

        <div class="hint" id="hintText">Tap the heart seal üíó</div>

        <div class="btnRow">
          <button class="btn" id="openBtn">Open üíñ</button>
          <button class="btn secondary" id="muteBtn" title="Optional sound (if you add it)">Sound: Off</button>
        </div>
      </div>

      <!-- SLIDES -->
      <div class="slides" id="slides">
        <div class="slide" data-i="0">
          <div class="sparkle"></div>
          <div class="kicker">FOR YOU</div>
          <div class="h1">Happy Valentine‚Äôs Day, <span id="herNameB">Love</span> üíó</div>
          <div class="p" id="msg1"></div>
          <div class="chipRow" id="chips"></div>
        </div>

        <div class="slide" data-i="1">
          <div class="sparkle"></div>
          <div class="kicker">A FEW THINGS I LOVE</div>
          <div class="h1">About you‚Ä¶</div>
          <div class="p" id="msg2"></div>
          <div class="chipRow" id="reasons"></div>
        </div>

        <div class="slide" data-i="2">
          <div class="sparkle"></div>
          <div class="kicker">MEMORIES</div>
          <div class="h1">Little moments, big feelings</div>
          <div class="p" id="msg3"></div>
          <div class="grid" id="grid"></div>
          <div class="p" style="margin-top:12px" id="photoTip"></div>
        </div>

        <div class="slide" data-i="3">
          <div class="sparkle"></div>
          <div class="kicker">ONE QUESTION</div>
          <div class="h1">Will you be my Valentine?</div>
          <div class="p" id="msg4"></div>
          <div class="qRow">
            <button class="btn yes" id="yesBtn">YES üò≠üíó</button>
            <button class="btn no" id="noBtn">No üôÉ</button>
          </div>
          <div class="p" style="margin-top:14px" id="result"></div>
        </div>

        <div class="nav">
          <button class="btn secondary" id="prevBtn">‚Üê Back</button>
          <div class="dots" id="dots"></div>
          <button class="btn" id="nextBtn">Next ‚Üí</button>
        </div>
      </div>

      <div class="foot">
        <span id="footLeft">Made with love</span>
        <span id="footRight"></span>
      </div>
    </div>
  </div>

  <audio id="song" preload="auto"></audio>

  <script>
    /***********************
     * CONFIG (EDIT THIS)
     ***********************/
    const CONFIG = {
      herName: "Ramya Arumugam",
      yourName: "Aswath",
      shortLine: "I‚Äôm lucky to have you. I‚Äôm proud of you. And I‚Äôm always on your side.",
      moodChips: ["cute", "soft", "private", "only for you"],
      reasons: [
        "Your smile (instant mood fix)",
        "Your voice (calms my brain)",
        "How you care about people",
        "The way you look at me ü´†",
        "Your ambition + heart"
      ],
      // OPTIONAL: add image URLs after you host them (or leave empty)
      photos: [
        { url: "./IMG_2040.JPG", label: "us" },
        { url: "./IMG_2468.jpg", label: "favorite" },
        { url: "./IMG_2567.jpg", label: "moment" }
      ],
      // OPTIONAL: add an audio file name you host next to index.html (example: "song.mp3")
      audioFile: "",
      footerRight: new Date().toLocaleDateString(undefined, { year:"numeric", month:"long", day:"numeric" })
    };

    /***********************
     * DOM
     ***********************/
    const panel = document.getElementById("panel");
    const env = document.getElementById("env");
    const seal = document.getElementById("seal");
    const openBtn = document.getElementById("openBtn");
    const muteBtn = document.getElementById("muteBtn");
    const stage = document.getElementById("stage");
    const slides = document.getElementById("slides");

    const herNameA = document.getElementById("herNameA");
    const herNameB = document.getElementById("herNameB");
    const msg1 = document.getElementById("msg1");
    const msg2 = document.getElementById("msg2");
    const msg3 = document.getElementById("msg3");
    const msg4 = document.getElementById("msg4");

    const chips = document.getElementById("chips");
    const reasons = document.getElementById("reasons");
    const grid = document.getElementById("grid");
    const photoTip = document.getElementById("photoTip");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const dots = document.getElementById("dots");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const result = document.getElementById("result");

    const footLeft = document.getElementById("footLeft");
    const footRight = document.getElementById("footRight");

    const song = document.getElementById("song");

    /***********************
     * INIT CONTENT
     ***********************/
    herNameA.textContent = CONFIG.herName;
    herNameB.textContent = CONFIG.herName;

    msg1.textContent = CONFIG.shortLine;
    msg2.textContent = "Not a long speech‚Ä¶ just facts: you make my days lighter, my mind calmer, and my life better.";
    msg3.textContent = "I keep replaying small moments and smiling like an idiot. Here‚Äôs a tiny gallery:";
    msg4.textContent = "Be honest‚Ä¶ (but choose wisely üòå)";

    footLeft.textContent = `Made by ${CONFIG.yourName} üíó`;
    footRight.textContent = CONFIG.footerRight;

    CONFIG.moodChips.forEach(t=>{
      const el = document.createElement("div");
      el.className = "chip";
      el.textContent = t;
      chips.appendChild(el);
    });

    CONFIG.reasons.forEach(t=>{
      const el = document.createElement("div");
      el.className = "chip";
      el.textContent = t;
      reasons.appendChild(el);
    });

    photoTip.textContent = CONFIG.memoryLine;

    // photos
    CONFIG.photos.forEach((p, idx)=>{
      const card = document.createElement("div");
      card.className = "ph";
      card.style.setProperty("--r", (idx===0? "-4deg" : idx===1? "3deg" : "-2deg"));
      if(p.url){
        const img = document.createElement("img");
        img.src = p.url;
        img.alt = p.label || "photo";
        card.appendChild(img);
      }
      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = p.label || "memory";
      card.appendChild(tag);
      grid.appendChild(card);
    });

    // audio
    let soundOn = false;
    if(CONFIG.audioFile){
      song.src = CONFIG.audioFile;
      muteBtn.style.display = "inline-flex";
    }else{
      muteBtn.style.display = "none";
    }

    /***********************
     * SLIDES LOGIC
     ***********************/
    const slideEls = Array.from(document.querySelectorAll(".slide"));
    let i = 0;

    function renderDots(){
      dots.innerHTML = "";
      slideEls.forEach((_, idx)=>{
        const d = document.createElement("div");
        d.className = "dot" + (idx===i ? " on": "");
        d.addEventListener("click", ()=>go(idx));
        dots.appendChild(d);
      });
    }

    function go(idx){
      i = Math.max(0, Math.min(slideEls.length-1, idx));
      slideEls.forEach(s=>s.classList.remove("active"));
      slideEls[i].classList.add("active");
      prevBtn.disabled = (i===0);
      nextBtn.textContent = (i===slideEls.length-1) ? "Done ‚ú®" : "Next ‚Üí";
      renderDots();
    }

    prevBtn.addEventListener("click", ()=>go(i-1));
    nextBtn.addEventListener("click", ()=>{
      if(i===slideEls.length-1){
        // tiny finale
        burstHearts(28);
        confetti(120);
      }else{
        go(i+1);
        burstHearts(10);
      }
    });

    /***********************
     * "NO" button that runs away (fun)
     ***********************/
    noBtn.addEventListener("mouseenter", moveNo);
    noBtn.addEventListener("click", moveNo);

    function moveNo(){
      const btn = noBtn;
      const rect = btn.getBoundingClientRect();
      const pad = 18;
      const maxX = window.innerWidth - rect.width - pad;
      const maxY = window.innerHeight - rect.height - pad;
      const x = Math.random() * maxX;
      const y = Math.random() * maxY;

      btn.style.position = "fixed";
      btn.style.left = x + "px";
      btn.style.top = y + "px";
      btn.style.zIndex = 9999;

      burstHearts(8);
      result.textContent = "Nice try üòå";
    }

    yesBtn.addEventListener("click", ()=>{
      result.textContent = `Yesss üò≠üíó I knew it. I‚Äôm taking you on a date.`;
      confetti(260);
      burstHearts(42);
      tryVibrate();
    });

    function tryVibrate(){
      if(navigator.vibrate) navigator.vibrate([50,40,50,40,80]);
    }

    /***********************
     * OPEN ENVELOPE
     ***********************/
    let opened = false;

    function openIt(){
      if(opened) return;
      opened = true;
      env.classList.add("opened");
      confetti(220);
      burstHearts(36);

      // after the envelope animation, reveal slides
      setTimeout(()=>{
        stage.style.display = "none";
        slides.classList.add("show");
        go(0);
      }, 900);

      // start sound if enabled (user gesture)
      if(soundOn && CONFIG.audioFile){
        song.play().catch(()=>{});
      }
    }

    openBtn.addEventListener("click", openIt);
    seal.addEventListener("click", openIt);

    muteBtn.addEventListener("click", ()=>{
      soundOn = !soundOn;
      muteBtn.textContent = "Sound: " + (soundOn ? "On" : "Off");
      if(CONFIG.audioFile){
        if(soundOn) song.play().catch(()=>{});
        else { song.pause(); song.currentTime = 0; }
      }
    });

    /***********************
     * CANVAS FX: confetti + hearts + sparkles
     ***********************/
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");
    let W=0,H=0, DPR=1;

    function resize(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = canvas.width = Math.floor(window.innerWidth * DPR);
      H = canvas.height = Math.floor(window.innerHeight * DPR);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
    }
    window.addEventListener("resize", resize, {passive:true});
    resize();

    const particles = [];
    function confetti(n=140){
      for(let k=0;k<n;k++){
        particles.push({
          type:"confetti",
          x: (Math.random()*W),
          y: -20*DPR,
          vx: (Math.random()*2-1)*2.2*DPR,
          vy: (Math.random()*2+1.2)*2.6*DPR,
          r: (Math.random()*6+3)*DPR,
          a: Math.random()*Math.PI*2,
          va: (Math.random()*0.2-0.1),
          life: 140 + Math.random()*60
        });
      }
    }

    function burstHearts(n=18){
      const cx = W/2, cy = H/2;
      for(let k=0;k<n;k++){
        const ang = Math.random()*Math.PI*2;
        const sp = (Math.random()*2.4+1.6)*DPR;
        particles.push({
          type:"heart",
          x: cx + (Math.random()*40-20)*DPR,
          y: cy + (Math.random()*20-10)*DPR,
          vx: Math.cos(ang)*sp,
          vy: Math.sin(ang)*sp - 1.2*DPR,
          s: (Math.random()*10+10)*DPR,
          life: 120 + Math.random()*50
        });
      }
    }

    function sparkle(x,y){
      particles.push({
        type:"sparkle",
        x,y,
        vx:(Math.random()*2-1)*1.2*DPR,
        vy:(Math.random()*2-1)*1.2*DPR,
        life: 60 + Math.random()*30
      });
    }

    function drawHeart(x,y,size,alpha){
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.translate(x,y);
      ctx.scale(size/26, size/26);
      ctx.rotate(-Math.PI/4);
      // gradient heart
      const g = ctx.createLinearGradient(-10,-10,20,20);
      g.addColorStop(0, "rgba(255,77,141,0.95)");
      g.addColorStop(1, "rgba(124,92,255,0.95)");
      ctx.fillStyle = g;
      roundRect(ctx, -2, -2, 26, 26, 7);
      ctx.beginPath();
      ctx.arc(11, 0, 13, 0, Math.PI*2);
      ctx.arc(0, -11, 13, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    }

    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
      ctx.fill();
    }

    // ambient sparkles
    let t=0;
    function loop(){
      t++;
      ctx.clearRect(0,0,W,H);

      // slow ambient twinkles
      if(t % 18 === 0){
        sparkle(Math.random()*W, Math.random()*H*0.7);
      }

      for(let p=particles.length-1; p>=0; p--){
        const o = particles[p];
        o.life -= 1;

        if(o.type==="confetti"){
          o.x += o.vx;
          o.y += o.vy;
          o.vy += 0.02*DPR;
          o.a += o.va;

          ctx.save();
          ctx.globalAlpha = Math.max(0, Math.min(1, o.life/120));
          ctx.translate(o.x, o.y);
          ctx.rotate(o.a);
          const g = ctx.createLinearGradient(-10,0,10,0);
          g.addColorStop(0,"rgba(255,77,141,.95)");
          g.addColorStop(1,"rgba(56,211,159,.95)");
          ctx.fillStyle = g;
          ctx.fillRect(-o.r, -o.r/2, o.r*2, o.r);
          ctx.restore();
        }

        if(o.type==="heart"){
          o.x += o.vx;
          o.y += o.vy;
          o.vy += 0.03*DPR;
          const alpha = Math.max(0, Math.min(1, o.life/120));
          drawHeart(o.x, o.y, o.s, alpha);
        }

        if(o.type==="sparkle"){
          o.x += o.vx;
          o.y += o.vy;
          const a = Math.max(0, Math.min(1, o.life/80));
          ctx.save();
          ctx.globalAlpha = a;
          ctx.fillStyle = "rgba(255,255,255,.85)";
          ctx.beginPath();
          ctx.arc(o.x, o.y, 1.2*DPR, 0, Math.PI*2);
          ctx.fill();
          ctx.restore();
        }

        if(o.life <= 0) particles.splice(p,1);
      }

      requestAnimationFrame(loop);
    }
    loop();

    // little touch sparkles
    window.addEventListener("pointerdown", (e)=>{
      sparkle(e.clientX*DPR, e.clientY*DPR);
      burstHearts(6);
    }, {passive:true});
  </script>
</body>
</html>
